<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="icon"
      href="data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A//www.w3.org/2000/svg%27%20viewBox%3D%270%200%2064%2064%27%3E%3Crect%20width%3D%2764%27%20height%3D%2764%27%20rx%3D%2712%27%20fill%3D%27%232563eb%27/%3E%3Cpath%20d%3D%27M32%2014l14%2036h-6l-3-8H27l-3%208h-6l14-36h6zm-3%2022h10l-5-14-5%2014z%27%20fill%3D%27white%27/%3E%3C/svg%3E"
    />
    <title>AiSchematicsEnsemble — CLI Install & Setup</title>
    <meta
      name="description"
      content="How to install and run the AiSchematicsEnsemble command-line interface (CLI)."
    />
    <style>
      :root {
        color-scheme: light dark;
        --fg: #111827;
        --muted: #6b7280;
        --bg: #ffffff;
        --card: #f9fafb;
        --border: rgba(0, 0, 0, 0.12);
        --link: #2563eb;
      }
      @media (prefers-color-scheme: dark) {
        :root {
          --fg: #e5e7eb;
          --muted: #9ca3af;
          --bg: #0b1020;
          --card: #0f172a;
          --border: rgba(255, 255, 255, 0.16);
          --link: #60a5fa;
        }
      }
      html[data-theme="light"] {
        color-scheme: light;
        --fg: #111827;
        --muted: #6b7280;
        --bg: #ffffff;
        --card: #f9fafb;
        --border: rgba(0, 0, 0, 0.12);
        --link: #2563eb;
      }
      html[data-theme="dark"] {
        color-scheme: dark;
        --fg: #e5e7eb;
        --muted: #9ca3af;
        --bg: #0b1020;
        --card: #0f172a;
        --border: rgba(255, 255, 255, 0.16);
        --link: #60a5fa;
      }
      body {
        margin: 0;
        font-family:
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Arial,
          sans-serif;
        color: var(--fg);
        background: var(--bg);
      }
      header {
        padding: 18px;
        border-bottom: 1px solid var(--border);
        background:
          linear-gradient(180deg, rgba(34, 197, 94, 0.12), transparent 55%),
          linear-gradient(180deg, rgba(96, 165, 250, 0.1), transparent 55%),
          var(--bg);
      }
      main {
        max-width: 980px;
        margin: 0 auto;
        padding: 18px;
      }
      .card {
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 16px;
        background: var(--card);
      }
      h1 {
        margin: 0 0 6px;
        letter-spacing: -0.02em;
      }
      h2 {
        margin: 18px 0 10px;
      }
      h3 {
        margin: 14px 0 8px;
      }
      p {
        margin: 10px 0;
        line-height: 1.55;
        color: var(--muted);
      }
      ul {
        margin: 10px 0 10px 18px;
        color: var(--muted);
        line-height: 1.55;
      }
      li {
        margin: 6px 0;
      }
      a {
        color: var(--link);
      }
      code {
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        font-size: 0.95em;
      }
      pre {
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 12px;
        overflow: auto;
        background: rgba(127, 127, 127, 0.08);
        margin: 10px 0;
      }
      .row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 12px;
      }
      .btn {
        display: inline-block;
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: 10px;
        text-decoration: none;
        color: var(--fg);
        background: transparent;
      }
      .pill {
        display: inline-block;
        padding: 2px 8px;
        border: 1px solid var(--border);
        border-radius: 999px;
        font-size: 12px;
        color: var(--muted);
      }
      .note {
        margin-top: 10px;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(127, 127, 127, 0.08);
        color: var(--muted);
      }
      .grid2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      @media (max-width: 860px) {
        .grid2 {
          grid-template-columns: 1fr;
        }
      }

      .themeWrap {
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      .themeSelect {
        padding: 6px 10px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: rgba(127, 127, 127, 0.08);
        color: var(--fg);
      }
    </style>
  </head>
  <body>
    <header>
      <div style="max-width: 980px; margin: 0 auto">
        <div class="pill">cli-help.html</div>
        <h1>AiSchematicsEnsemble — CLI Install & Setup</h1>
        <p>
          These instructions install and run the command-line tool locally. This
          is the "real" runner (it produces the run folders and outputs).
        </p>
        <div class="row">
          <span class="themeWrap pill" title="Theme (defaults to System)">
            Theme
            <select id="themeSelect" class="themeSelect">
              <option value="system">System</option>
              <option value="dark">Dark</option>
              <option value="light">Light</option>
            </select>
          </span>
          <a class="btn" href="index.html">Offline Home (index.html)</a>
          <a class="btn" href="offline-help.html">Offline UI help</a>
          <a class="btn" href="online-help.html">Online UI help</a>
          <a class="btn" href="help.html">Full help (help.html)</a>
          <a class="btn" href="README.md">README</a>
        </div>
      </div>
    </header>

    <main>
      <div class="card">
        <h2>Prerequisites</h2>
        <ul>
          <li>Node.js 18+ (includes <code>npm</code>).</li>
          <li>Git (to clone the repo).</li>
          <li>
            Optional: Graphviz (<code>dot</code>) to auto-generate
            <code>schematic.png</code> / <code>schematic.svg</code> (otherwise
            you still get <code>schematic.dot</code>).
          </li>
        </ul>

        <h3 id="graphviz-windows">Optional: Install Graphviz (Windows)</h3>
        <p>
          Graphviz is only needed if you want the tool to also render
          <code>schematic.png</code> / <code>schematic.svg</code>. Without it,
          you will still get <code>schematic.dot</code>.
        </p>
        <div class="note">
          If you need a higher-resolution PNG, either re-render a run’s
          <code>schematic.dot</code> with:
          <code>dot -Gdpi=300 -Tpng schematic.dot -o schematic_300dpi.png</code>
          or run the CLI with <code>--schematic-dpi 300</code> (or set
          <code>schematicDpi</code> in the JSON config).
        </div>
        <ol style="color: var(--muted); line-height: 1.55">
          <li>
            Download the official Windows x64 installer from
            <a
              href="https://graphviz.org/download/"
              target="_blank"
              rel="noreferrer"
              >https://graphviz.org/download/</a
            >
            (pick the stable Windows build).
          </li>
          <li>
            Run the installer. If it offers an option like “Add Graphviz to
            PATH”, enable it.
          </li>
          <li>
            Close and reopen PowerShell (so PATH refreshes), then verify:
            <pre><code>dot -V
where.exe dot</code></pre>
          </li>
        </ol>

        <h2>Install (recommended: run from this repo)</h2>
        <p>From a terminal:</p>
        <pre><code>git clone https://github.com/edbecnel/AiSchematicsEnsemble.git
cd AiSchematicsEnsemble
npm install
npm run build</code></pre>

        <h3>Verify the CLI runs</h3>
        <pre><code>node dist/index.js --help</code></pre>
        <p class="note">
          Tip: CLI reads <code>.env</code> automatically from your current
          working directory (it imports <code>dotenv/config</code> on startup).
          So if your keys live in <code>AiSchematicsEnsemble/.env</code>, just
          run the commands from that folder.
        </p>

        <h2>API keys (.env)</h2>
        <p>
          Create <code>.env</code> in the folder you run the CLI from (usually
          the repo root). Use the provided template:
        </p>
        <div class="grid2">
          <div>
            <div class="pill">PowerShell</div>
            <pre><code>Copy-Item .env.example .env</code></pre>
          </div>
          <div>
            <div class="pill">cmd.exe</div>
            <pre><code>copy .env.example .env</code></pre>
          </div>
        </div>
        <p>Fill in whichever providers you plan to use:</p>
        <pre><code>OPENAI_API_KEY=...
ANTHROPIC_API_KEY=...
GEMINI_API_KEY=...
XAI_API_KEY=...</code></pre>
        <div class="note">
          Ensembling uses Claude (Anthropic). If
          <code>ANTHROPIC_API_KEY</code> is missing, the ensemble step will
          fail.
        </div>

        <h2>Run</h2>
        <p>Example run using the bundled example files:</p>
        <pre><code>npm run run:example</code></pre>
        <p>Or run your own question file:</p>
        <pre><code>node dist/index.js run --question question.md</code></pre>

        <div class="note">
          If you use the local UI server (<code>npm run ui</code>), open the
          printed URL (default is <code>http://127.0.0.1:3210/</code>; if the
          port is busy it will try <code>3211</code>, <code>3212</code>, etc.).
        </div>

        <h2>Optional: create a global-ish command (developer convenience)</h2>
        <p>
          If you want to type <code>ai-schematics-ensemble</code> from anywhere
          while developing locally, you can use <code>npm link</code>.
        </p>
        <pre><code>npm link
ai-schematics-ensemble --help</code></pre>
        <p class="note">
          This is a local developer convenience. Because <code>dist/</code> is
          built output, you typically need to run
          <code>npm run build</code> after updating TypeScript.
        </p>

        <h2>Troubleshooting</h2>
        <ul>
          <li>
            <strong>"dotenv" keys not found</strong>: confirm you are running
            the CLI from the folder that contains <code>.env</code>, or export
            env vars in your shell.
          </li>
          <li>
            <strong>No schematic.png</strong>: install Graphviz and ensure
            <code>dot</code> is on PATH (see
            <a href="#graphviz-windows">Graphviz install steps</a>).
          </li>
          <li>
            <strong>Windows line endings warnings</strong>: harmless; Git may
            convert LF/CRLF depending on your config.
          </li>
        </ul>
      </div>
    </main>

    <script>
      (function () {
        const THEME_KEY = "ai-schematics-theme-v1";
        const sel = document.getElementById("themeSelect");

        function apply(choice) {
          const c = String(choice || "").toLowerCase();
          if (c === "dark" || c === "light") {
            document.documentElement.dataset.theme = c;
          } else {
            try {
              delete document.documentElement.dataset.theme;
            } catch {
              document.documentElement.removeAttribute("data-theme");
            }
          }
        }

        function load() {
          let saved = "system";
          try {
            saved = localStorage.getItem(THEME_KEY) || "system";
          } catch {
            saved = "system";
          }
          if (sel) sel.value = saved;
          apply(saved);
        }

        function save(choice) {
          const c = String(choice || "system").toLowerCase();
          try {
            if (c === "dark" || c === "light")
              localStorage.setItem(THEME_KEY, c);
            else localStorage.removeItem(THEME_KEY);
          } catch {
            // ignore
          }
          apply(c);
        }

        load();
        if (sel) sel.addEventListener("change", () => save(sel.value));
      })();
    </script>
  </body>
</html>
