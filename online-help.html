<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="icon"
      href="data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A//www.w3.org/2000/svg%27%20viewBox%3D%270%200%2064%2064%27%3E%3Crect%20width%3D%2764%27%20height%3D%2764%27%20rx%3D%2712%27%20fill%3D%27%232563eb%27/%3E%3Cpath%20d%3D%27M32%2014l14%2036h-6l-3-8H27l-3%208h-6l14-36h6zm-3%2022h10l-5-14-5%2014z%27%20fill%3D%27white%27/%3E%3C/svg%3E"
    />
    <title>AiSchematicsEnsemble — Online UI Help</title>
    <meta
      name="description"
      content="Help for using the online/server UI (online.html) for AiSchematicsEnsemble."
    />
    <style>
      :root {
        color-scheme: light dark;
        --fg: #111827;
        --muted: #6b7280;
        --bg: #ffffff;
        --card: #f9fafb;
        --border: rgba(0, 0, 0, 0.12);
        --link: #2563eb;
      }
      @media (prefers-color-scheme: dark) {
        :root {
          --fg: #e5e7eb;
          --muted: #9ca3af;
          --bg: #0b1020;
          --card: #0f172a;
          --border: rgba(255, 255, 255, 0.16);
          --link: #60a5fa;
        }
      }
      html[data-theme="light"] {
        color-scheme: light;
        --fg: #111827;
        --muted: #6b7280;
        --bg: #ffffff;
        --card: #f9fafb;
        --border: rgba(0, 0, 0, 0.12);
        --link: #2563eb;
      }
      html[data-theme="dark"] {
        color-scheme: dark;
        --fg: #e5e7eb;
        --muted: #9ca3af;
        --bg: #0b1020;
        --card: #0f172a;
        --border: rgba(255, 255, 255, 0.16);
        --link: #60a5fa;
      }
      body {
        margin: 0;
        font-family:
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Arial,
          sans-serif;
        color: var(--fg);
        background: var(--bg);
      }
      header {
        padding: 18px;
        border-bottom: 1px solid var(--border);
        background:
          linear-gradient(180deg, rgba(96, 165, 250, 0.14), transparent 55%),
          linear-gradient(180deg, rgba(34, 197, 94, 0.12), transparent 55%),
          var(--bg);
      }
      main {
        max-width: 980px;
        margin: 0 auto;
        padding: 18px;
      }
      .card {
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 16px;
        background: var(--card);
      }
      h1 {
        margin: 0 0 6px;
        letter-spacing: -0.02em;
      }
      h2 {
        margin: 18px 0 10px;
      }
      h3 {
        margin: 14px 0 8px;
      }
      p {
        margin: 10px 0;
        line-height: 1.55;
        color: var(--muted);
      }
      ul,
      ol {
        margin: 10px 0 10px 18px;
        color: var(--muted);
        line-height: 1.55;
      }
      li {
        margin: 6px 0;
      }
      a {
        color: var(--link);
      }
      code {
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        font-size: 0.95em;
      }
      .row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 12px;
      }
      .btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: 10px;
        text-decoration: none;
        color: var(--fg);
        background: transparent;
      }
      .pill {
        display: inline-block;
        padding: 2px 8px;
        border: 1px solid var(--border);
        border-radius: 999px;
        font-size: 12px;
        color: var(--muted);
      }
      .note {
        margin-top: 10px;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(127, 127, 127, 0.08);
        color: var(--muted);
      }
      .kbd {
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        font-size: 0.95em;
        padding: 2px 6px;
        border: 1px solid var(--border);
        border-radius: 8px;
        background: rgba(127, 127, 127, 0.1);
        color: var(--fg);
      }
      .themeWrap {
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      .themeSelect {
        padding: 6px 10px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: var(--bg);
        color: var(--fg);
      }

      /*
        Windows browsers can render <select>/<option> menus with a light menu
        background while inheriting a dark text color (or vice versa), leading
        to unreadable white-on-white. Force explicit colors for the dropdown.
      */
      .themeSelect option {
        background: var(--bg);
        color: var(--fg);
      }
      html[data-theme="light"] .themeSelect {
        color-scheme: light;
      }
      html[data-theme="dark"] .themeSelect {
        color-scheme: dark;
      }
    </style>
  </head>
  <body>
    <header>
      <div style="max-width: 980px; margin: 0 auto">
        <div class="pill">online-help.html</div>
        <h1>AiSchematicsEnsemble — Online UI Help</h1>
        <p>
          This page explains how to use <code>online.html</code> when running
          the local UI server (<code>npm run ui</code>).
        </p>
        <div class="row">
          <span class="themeWrap pill" title="Theme (defaults to System)">
            Theme
            <select id="themeSelect" class="themeSelect">
              <option value="system">System</option>
              <option value="dark">Dark</option>
              <option value="light">Light</option>
            </select>
          </span>
          <a class="btn" href="/online.html">Open app (online.html)</a>
          <a class="btn" href="/">Offline config (offline.html)</a>
          <a class="btn" href="/offline-help.html">Offline help</a>
          <a class="btn" href="/cli-help.html">CLI install</a>
          <a class="btn" href="/help.html">Full help</a>
        </div>
      </div>
    </header>

    <main>
      <div class="card">
        <h2 id="overview">What the online UI is</h2>
        <ul>
          <li>
            <strong>It runs the tool for you</strong>: when you click
            <span class="kbd">Run</span>, the server executes batch mode and
            creates a run folder under <code>runs/</code> (or your chosen
            outdir).
          </li>
          <li>
            <strong>Inputs are upload-only snapshots</strong>: choosing a file
            uploads it to <code>.ui_uploads/current/</code>. If you edit the
            original file later, re-upload.
          </li>
          <li>
            If you want copy/paste CLI commands, use the offline helper page
            (<code>offline.html</code>) instead.
          </li>
        </ul>

        <h2 id="quickstart">Quick start</h2>
        <ol>
          <li>
            Get the project onto your machine:
            <ul>
              <li>
                <strong>Git clone</strong> (recommended):
                <code
                  >git clone
                  https://github.com/edbecnel/AiSchematicsEnsemble.git</code
                >
              </li>
              <li>
                <strong>Download ZIP</strong>: open
                <a href="https://github.com/edbecnel/AiSchematicsEnsemble"
                  >https://github.com/edbecnel/AiSchematicsEnsemble</a
                >
                and use <strong>Code → Download ZIP</strong>, then unzip it.
              </li>
            </ul>
            <div class="note">
              Prereqs: install <strong>Node.js</strong> (LTS recommended). Then
              open a <strong>terminal</strong> (a command line), such as
              <strong>PowerShell</strong> or
              <strong>Command Prompt (cmd)</strong> on Windows (or the VS Code
              <strong>Terminal</strong> panel), in the project root folder (the
              one containing <code>package.json</code>).
            </div>
          </li>
          <li>
            In that terminal at the project root: <code>npm install</code>.
          </li>
          <li>Build: <code>npm run build</code>.</li>
          <li>Start the UI server: <code>npm run ui</code>.</li>
          <li>
            Open the printed URL (usually <code>http://127.0.0.1:3210/</code> or
            <code>http://127.0.0.1:3211/</code>) and go to
            <code>/online.html</code>.
          </li>
          <li>
            Upload a <code>question.md</code> file (required) and optional
            baseline netlist/image/includes.
          </li>
          <li>
            Set models/providers (optional), then click
            <span class="kbd">Run</span>.
          </li>
        </ol>

        <h2 id="uploads">Uploads (question, baseline, includes)</h2>
        <p>
          The three main inputs are uploaded as files and stored under
          <code>.ui_uploads/current/</code>.
        </p>
        <ul>
          <li>
            <strong>Question file</strong> is required. It should be a
            <code>.md</code> or <code>.txt</code> prompt describing your goal,
            constraints, and what you want changed.
          </li>
          <li>
            <strong>Baseline netlist</strong> and
            <strong>baseline image</strong>
            are optional but recommended.
          </li>
          <li>
            <strong>Baseline includes</strong>: upload one or more
            <code>.include/.lib</code> dependency files so an uploaded baseline
            netlist can reference them by relative path.
          </li>
        </ul>
        <div class="note">
          If you see a warning about <code>.ui_uploads</code>, it means the run
          is using uploaded snapshots.
        </div>

        <h2 id="models">Models + API keys</h2>
        <ul>
          <li>
            Under <strong>Models (optional)</strong>, use the checkboxes to
            enable/disable providers for the batch fanout.
          </li>
          <li>
            Use <span class="kbd">API Keys…</span> (or per-provider
            <span class="kbd">Keys</span>) to enter keys for this browser.
          </li>
          <li>
            Keys are stored in browser <code>localStorage</code> and are sent to
            the server only when you click <span class="kbd">Run</span>.
          </li>
        </ul>

        <h2 id="actions">Run &amp; Config</h2>
        <p>
          The <strong>Run &amp; Config</strong> section is where you run and
          manage config state:
        </p>
        <ul>
          <li>
            <span class="kbd">Run</span> executes a batch run on the server.
          </li>
          <li>
            <span class="kbd">Save config</span> /
            <span class="kbd">Load config</span>
            store and restore your settings in this browser.
          </li>
          <li>
            <span class="kbd">Export config</span> downloads an
            <code>ai-schematics.config.json</code> file.
          </li>
          <li>
            <span class="kbd">Import</span> loads a previously exported config
            JSON.
          </li>
          <li>
            <span class="kbd">Clear saved</span> clears the browser-saved
            config.
          </li>
        </ul>

        <h2 id="status">Status + downloads</h2>
        <ul>
          <li>The <strong>Status</strong> card shows progress, plus a log.</li>
          <li>
            After a run finishes you can
            <span class="kbd">Open run folder</span> and download
            <code>final.md</code>, <code>final.cir</code>, and
            <code>report.docx</code>.
          </li>
          <li>
            <span class="kbd">Open run folder</span> opens the run directory in
            Explorer/Finder on the machine running the server. (If the UI is
            hosted in the cloud later, this would open on the server machine,
            not your laptop.)
          </li>
          <li>
            <span class="kbd">Download SPICE netlist PNG</span> downloads the
            Graphviz connectivity image (<code>schematic.png</code>) if it was
            generated.
          </li>
          <li>
            <span class="kbd">View SPICE netlist PNG image</span> opens the same
            PNG inline in a browser tab.
          </li>
          <li>
            <span class="kbd">Download AI .md files</span> downloads a zip of
            all provider answer markdown files from the run’s
            <code>answers/</code> folder.
          </li>
        </ul>

        <h2 id="troubleshooting">Troubleshooting</h2>
        <ul>
          <li>
            <strong>Upload failed</strong>: try re-picking the file; the online
            UI depends on multipart upload support.
          </li>
          <li>
            <strong>Provider errors</strong>: confirm your API key for that
            provider is set (in the keys modal or in <code>.env</code> if you
            prefer).
          </li>
          <li>
            <strong>Graphviz not found</strong>: you’ll still get
            <code>schematic.dot</code>, but no <code>schematic.png</code> unless
            Graphviz is installed.
          </li>
        </ul>
      </div>
    </main>

    <script>
      (function () {
        const key = "ai-schematics-ensemble-help-theme";
        const sel = document.getElementById("themeSelect");
        const apply = (v) => {
          if (v === "light" || v === "dark")
            document.documentElement.dataset.theme = v;
          else delete document.documentElement.dataset.theme;
        };
        try {
          const saved = localStorage.getItem(key) || "system";
          sel.value = saved;
          apply(saved);
        } catch {}
        sel.addEventListener("change", () => {
          const v = sel.value;
          try {
            localStorage.setItem(key, v);
          } catch {}
          apply(v);
        });
      })();
    </script>
  </body>
</html>
