<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="icon"
      href="data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A//www.w3.org/2000/svg%27%20viewBox%3D%270%200%2064%2064%27%3E%3Crect%20width%3D%2764%27%20height%3D%2764%27%20rx%3D%2712%27%20fill%3D%27%232563eb%27/%3E%3Cpath%20d%3D%27M32%2014l14%2036h-6l-3-8H27l-3%208h-6l14-36h6zm-3%2022h10l-5-14-5%2014z%27%20fill%3D%27white%27/%3E%3C/svg%3E"
    />
    <title>AiSchematicsEnsemble — Offline UI Help</title>
    <meta
      name="description"
      content="Help for using offline.html on GitHub Pages or locally."
    />
    <style>
      :root {
        color-scheme: light dark;
        --fg: #111827;
        --muted: #6b7280;
        --bg: #ffffff;
        --card: #f9fafb;
        --border: rgba(0, 0, 0, 0.12);
        --link: #2563eb;
      }
      @media (prefers-color-scheme: dark) {
        :root {
          --fg: #e5e7eb;
          --muted: #9ca3af;
          --bg: #0b1020;
          --card: #0f172a;
          --border: rgba(255, 255, 255, 0.16);
          --link: #60a5fa;
        }
      }
      html[data-theme="light"] {
        color-scheme: light;
        --fg: #111827;
        --muted: #6b7280;
        --bg: #ffffff;
        --card: #f9fafb;
        --border: rgba(0, 0, 0, 0.12);
        --link: #2563eb;
      }
      html[data-theme="dark"] {
        color-scheme: dark;
        --fg: #e5e7eb;
        --muted: #9ca3af;
        --bg: #0b1020;
        --card: #0f172a;
        --border: rgba(255, 255, 255, 0.16);
        --link: #60a5fa;
      }
      body {
        margin: 0;
        font-family:
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Arial,
          sans-serif;
        color: var(--fg);
        background: var(--bg);
      }
      header {
        padding: 18px;
        border-bottom: 1px solid var(--border);
        background:
          linear-gradient(180deg, rgba(96, 165, 250, 0.14), transparent 55%),
          var(--bg);
      }
      main {
        max-width: 980px;
        margin: 0 auto;
        padding: 18px;
      }
      .card {
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 16px;
        background: var(--card);
      }
      h1 {
        margin: 0 0 6px;
        letter-spacing: -0.02em;
      }
      h2 {
        margin: 18px 0 10px;
      }
      p {
        margin: 10px 0;
        line-height: 1.55;
        color: var(--muted);
      }
      ul {
        margin: 10px 0 10px 18px;
        color: var(--muted);
        line-height: 1.55;
      }
      li {
        margin: 6px 0;
      }
      a {
        color: var(--link);
      }
      code {
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        font-size: 0.95em;
      }
      .row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 12px;
      }
      .btn {
        display: inline-block;
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: 10px;
        text-decoration: none;
        color: var(--fg);
        background: transparent;
      }
      .pill {
        display: inline-block;
        padding: 2px 8px;
        border: 1px solid var(--border);
        border-radius: 999px;
        font-size: 12px;
        color: var(--muted);
      }
      .note {
        margin-top: 10px;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(127, 127, 127, 0.08);
        color: var(--muted);
      }

      .toc {
        margin: 12px 0 0;
        padding: 12px 12px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(127, 127, 127, 0.06);
      }
      .toc strong {
        display: block;
        margin-bottom: 6px;
        color: var(--fg);
      }
      .toc ul {
        margin: 8px 0 0 18px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin: 10px 0;
        overflow: hidden;
        border: 1px solid var(--border);
        border-radius: 12px;
        background: rgba(127, 127, 127, 0.04);
      }
      th,
      td {
        text-align: left;
        vertical-align: top;
        padding: 10px 12px;
        border-bottom: 1px solid var(--border);
      }
      th {
        color: var(--fg);
        font-weight: 650;
        background: rgba(127, 127, 127, 0.06);
      }
      tr:last-child td {
        border-bottom: none;
      }

      .kbd {
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        font-size: 0.95em;
        padding: 2px 6px;
        border: 1px solid var(--border);
        border-radius: 8px;
        background: rgba(127, 127, 127, 0.1);
        color: var(--fg);
      }

      .themeWrap {
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      .themeSelect {
        padding: 6px 10px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: var(--bg);
        color: var(--fg);
      }

      /* Prevent unreadable native dropdown menu colors on Windows */
      .themeSelect option {
        background: var(--bg);
        color: var(--fg);
      }
      html[data-theme="light"] .themeSelect {
        color-scheme: light;
      }
      html[data-theme="dark"] .themeSelect {
        color-scheme: dark;
      }
    </style>
  </head>
  <body>
    <header>
      <div style="max-width: 980px; margin: 0 auto">
        <div class="pill">offline-help.html</div>
        <h1>AiSchematicsEnsemble — Offline UI Help</h1>
        <p>
          This page explains how to use <code>offline.html</code> when hosted on
          GitHub Pages (online) or when opened directly on your computer.
        </p>
        <div class="row">
          <span class="themeWrap pill" title="Theme (defaults to System)">
            Theme
            <select id="themeSelect" class="themeSelect">
              <option value="system">System</option>
              <option value="dark">Dark</option>
              <option value="light">Light</option>
            </select>
          </span>
          <a class="btn" href="index.html">Offline Home (index.html)</a>
          <a class="btn" href="offline.html">Open app (offline.html)</a>
          <a class="btn" href="cli-help.html">CLI install (cli-help.html)</a>
          <a class="btn" href="help.html">Full help (help.html)</a>
          <a class="btn" href="README.md">README</a>
        </div>
      </div>
    </header>

    <main>
      <div class="card">
        <h2 id="overview">What offline.html is (and isn’t)</h2>
        <ul>
          <li>
            <strong>It is a helper page</strong> that generates a config JSON
            plus copy/paste CLI commands.
          </li>
          <li>
            <strong>It does not run anything in the browser</strong>. Your
            actual run happens when you paste the command into a terminal.
          </li>
          <li>
            It can store your settings and (optionally) API keys in browser
            storage (<code>localStorage</code>) on your device.
          </li>
        </ul>

        <div class="toc">
          <strong>On this page</strong>
          <ul>
            <li><a href="#quickstart">Quick start</a></li>
            <li><a href="#modes">Three ways to open offline.html</a></li>
            <li><a href="#paths">Understanding file paths</a></li>
            <li><a href="#controls">UI controls (what each one does)</a></li>
            <li><a href="#keys">API keys modal</a></li>
            <li><a href="#commands">Command preview (A/B/C)</a></li>
            <li><a href="#troubleshooting">Troubleshooting</a></li>
            <li><a href="#faq">FAQ</a></li>
          </ul>
        </div>

        <h2 id="quickstart">Quick start</h2>
        <p>
          The best experience is to run the local UI server (it enables uploads
          and <code>Load from .env</code>). If you can’t, you can still use
          offline.html by pasting paths manually.
        </p>
        <h3>Recommended: local UI server</h3>
        <ol>
          <li>
            In a terminal at the project root: <code>npm install</code>, then
            <code>npm run build</code>.
          </li>
          <li>Start the UI: <code>npm run ui</code>.</li>
          <li>
            Open the printed URL (default is
            <code>http://127.0.0.1:3210/</code>; if busy it may choose
            <code>3211</code>, <code>3212</code>, etc.).
          </li>
          <li>
            Open <code>offline.html</code> from that server (use the “Offline
            config” link if present).
          </li>
          <li>
            Use the file pickers to upload <code>question.md</code>, your
            baseline netlist, and/or baseline image. Click
            <span class="kbd">Update preview</span>.
          </li>
          <li>
            Click <span class="kbd">Download JSON</span> and save it into your
            project root (same folder as <code>package.json</code>).
          </li>
          <li>
            Optional: set “Config filename” to a relative path like
            <code>config\ai-schematics.config.json</code> if you want to keep
            configs in a subfolder. Note: browsers can’t download into
            subfolders — it will download as just the filename, so move it into
            <code>config/</code> afterward.
          </li>
          <li>
            Copy the PowerShell or cmd command from “Command preview” and run it
            locally.
          </li>
        </ol>
        <div class="note">
          The generated commands include <code>--no-prompts</code> so the run is
          non-interactive. If you prefer prompts, remove that flag.
        </div>

        <h3>Minimal: open the file directly (file://)</h3>
        <ol>
          <li>Open <code>offline.html</code> in your browser.</li>
          <li>
            Paste real paths into the text boxes (Windows example:
            <code>D:\\Dev\\AiSchematicsEnsemble\\examples\\question.md</code>).
          </li>
          <li>
            Click <span class="kbd">Update preview</span>, then copy a command
            and run it from the project root.
          </li>
        </ol>

        <h2 id="modes">Three ways to open offline.html</h2>
        <table>
          <thead>
            <tr>
              <th>Where you open it</th>
              <th>What works best</th>
              <th>What to watch for</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Local UI server</strong> (recommended)</td>
              <td>
                File picker uploads (gets real paths),
                <code>Load from .env</code>
                button works.
              </td>
              <td>
                Still doesn’t “run in browser” — it only generates commands.
              </td>
            </tr>
            <tr>
              <td><strong>GitHub Pages</strong> (online hosting)</td>
              <td>Good for generating commands and downloading JSON.</td>
              <td>
                There is no backend, so uploads and “Load from .env” won’t work.
                To avoid pasting full paths, either:
                <ul>
                  <li>
                    Use the file pickers and then
                    <strong>download the JSON config</strong> (by default the
                    picked files are embedded into the config). Run the
                    <strong>JSON-config command</strong>.
                  </li>
                  <li>
                    Or enable <strong>Prefer filename only</strong> (don’t
                    embed) if your files are hosted alongside
                    <code>offline.html</code> (or you know the CLI will be able
                    to read them by the resulting relative path).
                  </li>
                </ul>
              </td>
            </tr>
            <tr>
              <td><strong>Direct file open</strong> (<code>file://</code>)</td>
              <td>Good for generating commands.</td>
              <td>
                Browsers do not reveal full local file paths to JavaScript. Use
                the file pickers + download JSON config (embedded files), or
                enable <strong>Prefer filename only</strong> to fill in just the
                filename, or paste a real path if you want full control.
              </td>
            </tr>
          </tbody>
        </table>

        <h2 id="paths">Understanding file paths</h2>
        <ul>
          <li>
            Every path you enter is a path that the <strong>CLI</strong> must be
            able to read when you run the generated command.
          </li>
          <li>
            Relative paths (like <code>examples/question.md</code>) are resolved
            relative to where you run the command (usually the project root).
          </li>
          <li>
            Absolute paths (like <code>D:\\...\\question.md</code>) are fine if
            you prefer.
          </li>
        </ul>
        <div class="note">
          If you use the local UI server, picking a file uploads it and replaces
          the text box with a server path (under <code>.ui_uploads</code>). That
          makes the generated command “just work” when run from the project
          root. <br /><br />
          <strong>Important:</strong> those uploaded paths are a
          <em>snapshot</em>. If you edit the original file later, the CLI will
          not see your edits unless you re-upload (pick the file again) or paste
          a real path to your source file. <br /><br />
          Newer versions use stable paths like
          <code>.ui_uploads/current/question.*</code>,
          <code>.ui_uploads/current/baseline_netlist.*</code>, and
          <code>.ui_uploads/current/baseline_image.*</code> so that re-uploading
          updates what previously-copied commands reference.
        </div>

        <h2 id="controls">UI controls (what each one does)</h2>
        <p>
          These names match what you’ll see in <code>offline.html</code>. Think
          of the left card as “config inputs” and the right card as “copy/paste
          output”.
        </p>

        <h3>Inputs</h3>
        <table>
          <thead>
            <tr>
              <th>Control</th>
              <th>What it does</th>
              <th>Tips / gotchas</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Question file</strong></td>
              <td>
                Required. The markdown/text prompt that describes your goal and
                constraints.
              </td>
              <td>If blank, the preview warns because the CLI requires it.</td>
            </tr>
            <tr>
              <td><strong>Baseline netlist</strong></td>
              <td>
                Optional but recommended. A SPICE netlist (e.g.
                <code>.cir</code>) representing your current circuit.
              </td>
              <td>
                Use <code>Bundle includes</code> if your netlist uses
                <code>.include</code> / <code>.lib</code> files.
              </td>
            </tr>
            <tr>
              <td><strong>Baseline image</strong></td>
              <td>
                Optional. A schematic screenshot/photo to give the models extra
                context.
              </td>
              <td>
                Any <code>image/*</code> file is accepted (png/jpg/webp, etc.).
              </td>
            </tr>
            <tr>
              <td><strong>Outdir</strong></td>
              <td>
                Where runs are written (default <code>runs</code>), relative to
                the project root unless you use an absolute path.
              </td>
              <td>
                Use a separate folder when experimenting so you can compare
                outputs across runs.
              </td>
            </tr>
            <tr>
              <td><strong>Schematic DPI</strong></td>
              <td>
                Optional. Controls the resolution of the generated
                <code>schematic.png</code> (Graphviz).
              </td>
              <td>
                Leave blank to use Graphviz defaults. For zooming/printing,
                prefer <code>schematic.svg</code>.
              </td>
            </tr>
            <tr>
              <td><strong>Bundle includes</strong></td>
              <td>
                Controls whether the CLI copies referenced include files into
                the run folder.
              </td>
              <td>
                This is a text field: set it to <code>true</code> /
                <code>false</code> (also accepts <code>1</code>,
                <code>yes</code>, <code>y</code>).
              </td>
            </tr>
            <tr>
              <td><strong>Prefer filename only</strong></td>
              <td>
                When enabled, file picking fills the path textbox with the
                filename instead of embedding bytes into the JSON config.
              </td>
              <td>
                This can make the explicit-params command available, but it only
                works if the file will exist at that path when you run the CLI.
              </td>
            </tr>
            <tr>
              <td><strong>Browse “…”</strong> (file picker)</td>
              <td>Selects a local file for convenience.</td>
              <td>
                If served by the local UI server, the file is uploaded and the
                path becomes a real server path. Without a server (GitHub Pages
                or <code>file://</code>), offline.html either embeds the picked
                file into the JSON config (default) or uses filename-only if the
                file appears reachable next to the page or you enabled
                <strong>Prefer filename only</strong>.
              </td>
            </tr>
            <tr>
              <td><strong>✕</strong> (clear button)</td>
              <td>Clears the corresponding path and picked-file hint.</td>
              <td>
                Useful when switching between a server-uploaded path and a
                manual path.
              </td>
            </tr>
          </tbody>
        </table>

        <h3>Models (optional)</h3>
        <p>
          These fields control the model names passed to the CLI. If you clear a
          model field, it will be omitted from the explicit command.
        </p>
        <ul>
          <li>
            <strong>OpenAI model</strong> → adds <code>--openai-model</code>
          </li>
          <li><strong>Grok model</strong> → adds <code>--grok-model</code></li>
          <li>
            <strong>Gemini model</strong> → adds <code>--gemini-model</code>
          </li>
          <li>
            <strong>Claude model</strong> → adds <code>--claude-model</code>
          </li>
        </ul>
        <div class="note">
          Ensemble uses Claude (Anthropic). If you don’t have an Anthropic key
          available when you run the CLI, the ensemble step will fail.
        </div>

        <h3>Config actions</h3>
        <table>
          <thead>
            <tr>
              <th>Button</th>
              <th>What it does</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Update preview</strong></td>
              <td>Rebuilds the command preview from the current fields.</td>
              <td>
                Also runs automatically after many actions (file pick/import,
                keys load, etc.).
              </td>
            </tr>
            <tr>
              <td><strong>Save config to browser</strong></td>
              <td>Saves the current config JSON into this browser profile.</td>
              <td>
                Uses <code>localStorage</code>. Privacy mode or strict settings
                may block it.
              </td>
            </tr>
            <tr>
              <td><strong>Load config from browser</strong></td>
              <td>Loads the last saved config from this browser profile.</td>
              <td>Does not affect any files on disk.</td>
            </tr>
            <tr>
              <td><strong>Download JSON</strong></td>
              <td>Downloads a config JSON file to your computer.</td>
              <td>
                The name comes from “Config filename” on the right. If you
                include a relative path (e.g.
                <code>config\ai-schematics.config.json</code>), browsers still
                download to your normal Downloads folder — move it into the
                subfolder yourself.
              </td>
            </tr>
            <tr>
              <td><strong>Import JSON</strong></td>
              <td>Loads a config JSON file you previously downloaded.</td>
              <td>
                Handy for sharing configs or iterating on saved experiments.
              </td>
            </tr>
            <tr>
              <td><strong>Clear saved config</strong></td>
              <td>Deletes the browser-saved config.</td>
              <td>Does not delete downloaded JSON files.</td>
            </tr>
          </tbody>
        </table>

        <h2 id="keys">API keys modal (offline)</h2>
        <p>
          Open it using <span class="kbd">API Keys…</span> or any model’s
          <span class="kbd">Keys</span> button. Keys are used only to generate
          commands (as environment-variable prefixes).
        </p>
        <ul>
          <li>
            <strong>Show/Hide</strong> toggles masking for each key field.
          </li>
          <li>
            <strong>Save to browser</strong> stores the keys in
            <code>localStorage</code> for future visits.
          </li>
          <li>
            <strong>Browse… .env</strong> lets you load keys from a local
            <code>.env</code> file (it reads the file in the browser). This does
            <em>not</em> save them unless you click “Save to browser”.
          </li>
          <li>
            <strong>Load from .env</strong> appears only when offline.html is
            served by the local UI server. It fetches keys from the project’s
            <code>.env</code> via an API endpoint and fills the fields.
          </li>
          <li>
            <strong>Clear browser keys</strong> deletes the browser-saved keys.
          </li>
        </ul>
        <div class="note">
          If you already have a working <code>.env</code> and you run the CLI
          from the project root, you often don’t need any of this: the CLI loads
          <code>.env</code> automatically. See
          <a href="cli-help.html">cli-help.html</a>.
        </div>

        <h2 id="commands">Command preview: options A/B/C</h2>
        <p>
          The right-hand card shows multiple ways to use the same inputs/models
          from this page.
        </p>
        <ul>
          <li>
            <strong>A) Run using JSON config</strong> uses
            <code>--config ...</code>. This is the easiest to share and
            reproduce. You can change “Config filename” to a relative path like
            <code>config\ai-schematics.config.json</code>; the command updates
            as you type.
          </li>
          <li>
            <strong>B) Run using explicit parameters</strong> spells out every
            flag. This is useful when you don’t want to manage a config file.
          </li>
          <li>
            <strong>C) Interactive chat</strong> runs the CLI REPL (<code
              >node dist/index.js chat</code
            >) so you can ask questions and optionally save a transcript with
            <code>--save</code>.
          </li>
        </ul>
        <p>
          Each preview includes both a PowerShell and a cmd.exe version, plus an
          optional environment-variable prefix if you filled in keys.
        </p>

        <h2 id="troubleshooting">Troubleshooting</h2>
        <ul>
          <li>
            <strong>“Question file is required”</strong>: fill in “Question
            file” with a real path the CLI can read.
          </li>
          <li>
            <strong>File picker only shows a filename</strong>: this is expected
            in <code>file://</code> mode. You can paste a full path manually, or
            use “Download JSON” (embedded inputs), or enable “Prefer filename
            only” if you want the textbox to stay as a simple filename.
          </li>
          <li>
            <strong>Upload failed</strong> when hosted online: GitHub Pages has
            no backend endpoints (<code>/api/upload</code>), so uploads cannot
            work. Use “Download JSON” (embedded inputs) or paste paths manually.
          </li>
          <li>
            <strong>“Save to browser” fails</strong>: your browser may be
            blocking <code>localStorage</code> (privacy mode, strict settings,
            corporate policy). You can still use “Download JSON”.
          </li>
          <li>
            <strong>Copy buttons don’t copy</strong>: some environments block
            clipboard access. Select the text and copy manually.
          </li>
          <li>
            <strong>Paths with spaces</strong>: use the preview’s quoted command
            exactly; it adds quoting for PowerShell/cmd.
          </li>
          <li>
            <strong>Build missing</strong>: the commands assume you’ve run
            <code>npm run build</code> so <code>dist/index.js</code> exists.
          </li>
        </ul>

        <h2 id="faq">FAQ</h2>
        <ul>
          <li>
            <strong>Does offline.html run the tool?</strong> No. It only
            generates config + commands.
          </li>
          <li>
            <strong>Where should I run the generated command?</strong> From the
            project root (the folder containing <code>package.json</code>).
          </li>
          <li>
            <strong>Are my keys sent anywhere?</strong> Not by this page. They
            are used locally to generate environment-variable prefixes. Still,
            avoid saving keys in a shared browser profile.
          </li>
        </ul>
      </div>
    </main>

    <script>
      (function () {
        const THEME_KEY = "ai-schematics-theme-v1";
        const sel = document.getElementById("themeSelect");

        function apply(choice) {
          const c = String(choice || "").toLowerCase();
          if (c === "dark" || c === "light") {
            document.documentElement.dataset.theme = c;
          } else {
            try {
              delete document.documentElement.dataset.theme;
            } catch {
              document.documentElement.removeAttribute("data-theme");
            }
          }
        }

        function load() {
          let saved = "system";
          try {
            saved = localStorage.getItem(THEME_KEY) || "system";
          } catch {
            saved = "system";
          }
          if (sel) sel.value = saved;
          apply(saved);
        }

        function save(choice) {
          const c = String(choice || "system").toLowerCase();
          try {
            if (c === "dark" || c === "light")
              localStorage.setItem(THEME_KEY, c);
            else localStorage.removeItem(THEME_KEY);
          } catch {
            // ignore
          }
          apply(c);
        }

        load();
        if (sel) sel.addEventListener("change", () => save(sel.value));
      })();
    </script>
  </body>
</html>
